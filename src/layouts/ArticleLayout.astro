---
import type { MarkdownHeading } from "astro";
import { fade } from "astro:transitions";
import RootLayout from "./RootLayout.astro";
import TableOfContents from "../components/TableOfContents.astro";
import { Image } from "astro:assets";
import clsx from "clsx";
import type { ActiveTabType } from "../components/Header.astro";

interface Props {
  id: string;
  title: string;
  headings?: MarkdownHeading[];
  activeTab?: ActiveTabType;
  type: "article" | "project" | "page";
  image?: {
    src?: string;
    width?: number;
    height?: number;
    format?: "png" | "jpg" | "jpeg" | "tiff" | "webp" | "gif" | "svg" | "avif";
  }; // TODO: extract to a type or find astro type
}

const { id, title, image, type, headings, activeTab } = Astro.props;
---

<RootLayout activeTab={activeTab} title={title}>
  <main id="content" class="w-full max-w-5xl xl:max-w-6xl mx-auto px-5 py-10">
    <article class="flex flex-col">
      {
        image && (
          <Image
            transition:animate="none"
            densities={[1, 2, 3]}
            class="w-full sticky top-10 left-0 z-10"
            transition:name={`${type}-${id}-image`}
            src={image}
            alt={``}
          />
        )
      }
      <div class={clsx("bg-white flex flex-col gap-10 pb-20 relative z-20")}>
        <h1
          id={`${type}-title`}
          class="font-serif transition-all bg-white data-[scrolled=true]:text-3xl block py-5 z-10 sticky top-0 text-4xl lg:text-5xl xl:text-6xl"
          transition:name={`${type}-${id}-title`}
        >
          {title}
        </h1>
        <section
          transition:animate={fade({ duration: "0.4s" })}
          class="w-full flex justify-between flex-row md:gap-14 lg:gap-14 xl:gap-28"
        >
          <div class="prose flex-grow break-keep hyphens-auto">
            <slot />
          </div>
          {
            headings && (
              <aside class="sticky hidden lg:block top-20 xl:top-24 md:w-[250px] lg:w-[300px] text-sm xl:text-base max-h-[100dvh] overflow-auto scroll-m-4">
                <TableOfContents headings={headings} />
              </aside>
            )
          }
        </section>
      </div>
    </article>

    <script define:vars={{ type }}>
      // window.addEventListener("scroll", (e) => {
      //   const title = document.getElementById(`${type}-title`);

      //   if (title) {
      //     const titleRect = title.getBoundingClientRect();
      //     const delta = 600;
      //     const passedTop = window.scrollY > delta;

      //     if (passedTop) {
      //       title.setAttribute("data-scrolled", "true");
      //     } else {
      //       title.setAttribute("data-scrolled", "false");
      //     }
      //   }
      // });
    </script>
  </main>
</RootLayout>
