---
import { getCollection } from "astro:content";
import {
  InferGetStaticParamsType,
  InferGetStaticPropsType,
  GetStaticPaths,
} from "astro";
import ArticleLayout from "../../layouts/ArticleLayout.astro";
import BackButton from "../../components/BackButton.astro";
import { Image } from "astro:assets";

export const getStaticPaths = (async () => {
  const articles = await getCollection("articles");

  return articles.map((entry) => {
    return {
      params: { slug: entry.slug },
      props: { entry },
    };
  });
}) satisfies GetStaticPaths;

type Params = InferGetStaticParamsType<typeof getStaticPaths>;
type Props = InferGetStaticPropsType<typeof getStaticPaths>;

const { entry } = Astro.props as Props;
const { Content, headings } = await entry.render();
---

<ArticleLayout headings={headings} title={entry.data.title}>
  {
    entry.data.image && (
      <Image
        src={entry.data.image}
        width={300}
        alt={`Book cover of ${entry.data.title}`}
      />
    )
  }
  <div class="prose">
    <header>
      <h1 transition:name={`article-${entry.id}-title`}>{entry.data.title}</h1>
      <p transition:name={`article-${entry.id}-description`}>
        {entry.data.description}
      </p>
    </header>

    <div>
      <Content />
    </div>
  </div>
</ArticleLayout>
